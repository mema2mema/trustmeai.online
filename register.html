<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>Register â€” TrustMe AI</title>
  <link rel="stylesheet" href="style.css"/>
  <style>.auth-box{max-width:520px;margin:48px auto}</style>
</head>
<body>
  <main class="auth-box">
    <div class="card">
      <div class="stripe"></div>
      <h2>Create Account</h2>
      <form id="regForm">
        <label class="small">Email</label>
        <input id="regEmail" class="input" type="email" placeholder="you@example.com" required/>
        <label class="small" style="margin-top:.6rem">Password</label>
        <input id="regPass" class="input" type="password" placeholder="At least 6 characters" required/>
        <label class="small" style="margin-top:.6rem">Re-type Password</label>
        <input id="regPass2" class="input" type="password" placeholder="Repeat password" required/>
        <div class="grid grid-2" style="gap:.6rem;margin-top:.6rem">
          <div>
            <label class="small">Email Code</label>
            <input id="regCode" class="input" type="text" placeholder="6-digit code" disabled required/>
          </div>
          <div style="display:flex;align-items:flex-end">
            <button id="sendCode" type="button" class="btn" style="width:100%">Send Code</button>
          </div>
        </div>
        <label class="small" style="margin-top:.6rem">Referral Code (optional)</label>
        <input id="regRef" class="input" type="text" placeholder="ABC123 (optional)"/>
        <button class="btn" style="width:100%;margin-top:.9rem">Create Account</button>
      </form>
      <p class="small" style="margin-top:.6rem">Already registered? <a href="login.html">Login</a></p>
      <pre id="dbg" style="opacity:.7;font-size:.8rem"></pre>
    </div>
  </main>
  <script src="tm-auth.js" onerror="document.getElementById('dbg').textContent='tm-auth.js failed to load from /tm-auth.js'"></script>
  <script>
    (function(){
      const dbg=t=>document.getElementById('dbg').textContent=t||'';
      if(!window.TMAuth){ dbg('TMAuth not found. Ensure tm-auth.js is in the site root.'); return; }
      let CODE=null, EXP=0;
      document.getElementById('sendCode').addEventListener('click', ()=>{
        const email=document.getElementById('regEmail').value.trim().toLowerCase();
        const p=document.getElementById('regPass').value.trim();
        const p2=document.getElementById('regPass2').value.trim();
        if(!/^[^@\s]+@[^@\s]+\.[^@\s]+$/.test(email)) return alert('Enter a valid email first');
        if(p.length<6) return alert('Password must be at least 6 characters');
        if(p!==p2) return alert('Passwords do not match');
        CODE=String(Math.floor(100000+Math.random()*900000)); EXP=Date.now()+10*60*1000;
        alert('Demo code: '+CODE+' (valid 10 min)');
        const codeInput=document.getElementById('regCode'); codeInput.disabled=false; codeInput.focus();
      });
      document.getElementById('regForm').addEventListener('submit', async (e)=>{
        e.preventDefault();
        const email=document.getElementById('regEmail').value.trim().toLowerCase();
        const pass=document.getElementById('regPass').value.trim();
        const pass2=document.getElementById('regPass2').value.trim();
        const code=document.getElementById('regCode').value.trim();
        const ref=document.getElementById('regRef').value.trim();
        if(pass!==pass2) return alert('Passwords do not match');
        if(!CODE || Date.now()>EXP || code!==CODE) return alert('Invalid or expired code');
        const ok = await TMAuth.register({email, pass, ref});
        if(!ok){ alert('Email already exists. Please login.'); location.href='login.html'; return; }
        const next=new URLSearchParams(location.search).get('next')||'index.html';
        location.href=next;
      });
    })();
  </script>
</body>
</html>