<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>Invite Friends — TrustMe AI</title>
  <link rel="stylesheet" href="styles.css"/>
</head>
<body>
  <header class="topbar">
    <button onclick="history.back()" class="btn sm plain">← Back</button>
    <div class="brand"><div class="title">Invite Friends</div></div>
  </header>

  <main class="page active" style="padding:16px">
    <div class="grid2">
      <div class="card">
        <h3>QR Code</h3>
        <div id="qrBox" style="width:260px;height:260px;background:#0b0f14;border-radius:12px;display:flex;align-items:center;justify-content:center;"></div>
        <p class="muted small">Scanning the QR opens your personal registration link.</p>
      </div>

      <div class="card">
        <h3>Invite Link</h3>
        <div class="copyline">
          <input id="inviteLink" readonly/>
          <button id="copyLink" class="btn sm">Copy</button>
          <button id="shareBtn" class="btn sm">Share</button>
        </div>

        <h3 style="margin-top:1rem;">Invitation Code</h3>
        <div class="copyline">
          <input id="inviteCode" value="TMI8K"/>
          <button id="copyCode" class="btn sm">Copy</button>
        </div>
        <p class="muted small">Tip: change the code — your link & QR update automatically.</p>
      </div>
    </div>
  </main>

  <!-- QR library from CDN (self-host later if needed) -->
  <script src="https://cdn.jsdelivr.net/npm/qrcodejs@1.0.0/qrcode.min.js"></script>
  <script>
  (function(){
    const codeInput = document.getElementById('inviteCode');
    const linkInput = document.getElementById('inviteLink');
    const qrBox = document.getElementById('qrBox');
    function buildLink(code){ return (location.origin + '/reg?ref=' + encodeURIComponent((code||'').trim() || 'TMI8K')); }
    function render(){
      const url = buildLink(codeInput.value);
      linkInput.value = url;
      qrBox.innerHTML = '';
      try{ new QRCode(qrBox, { text:url, width:256, height:256, correctLevel:QRCode.CorrectLevel.M }); }
      catch(e){ qrBox.textContent = 'QR error: ' + (e && e.message ? e.message : 'reload'); }
    }
    document.getElementById('copyLink').onclick = async ()=> { try { await navigator.clipboard.writeText(linkInput.value); } catch{} };
    document.getElementById('copyCode').onclick = async ()=> { try { await navigator.clipboard.writeText(codeInput.value); } catch{} };
    document.getElementById('shareBtn').onclick = async ()=> {
      const url = linkInput.value;
      try { if (navigator.share) await navigator.share({ title:'Join TrustMe AI', url }); else await navigator.clipboard.writeText(url); } catch{}
    };
    codeInput.addEventListener('input', render);
    render();
  })();
  </script>
</body>
</html>
