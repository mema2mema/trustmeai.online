<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>My Team â€” TrustMe AI</title>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@700&family=Inter:wght@400;500&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="style.css">
  <style>
    .team-wrap{max-width:760px;margin:0 auto}
    .team-card{padding:1rem}
    .team-row{display:flex;justify-content:space-between;padding:.5rem 0;border-bottom:1px solid rgba(255,255,255,.08)}
    .team-row:last-child{border-bottom:0}
    .invite-box{background:rgba(255,255,255,.04);padding:1rem;border-radius:8px;margin:.8rem 0}
    .copy-btn{cursor:pointer;border:0;background:var(--soft);color:#fff;padding:.35rem .75rem;border-radius:6px;font-size:.85rem}
    @media(max-width:640px){
      .team-row{flex-direction:column;align-items:flex-start;gap:.25rem}
    }
  </style>

<style>
#toast {
  visibility: hidden;
  min-width: 200px;
  margin-left: -100px;
  background-color: #333;
  color: #fff;
  text-align: center;
  border-radius: 8px;
  padding: 10px;
  position: fixed;
  z-index: 1;
  left: 50%;
  bottom: 30px;
  font-size: 14px;
  opacity: 0;
  transition: opacity 0.5s, bottom 0.5s;
}
#toast.show {
  visibility: visible;
  opacity: 1;
  bottom: 50px;
}
</style>


<style>
.team-tools{display:flex;gap:.5rem;flex-wrap:wrap;margin:.5rem 0}
.btn-mini{background:var(--soft,#24354a);border:0;color:#fff;padding:.4rem .6rem;border-radius:6px;cursor:pointer;font-size:.85rem}
.btn-mini:active{transform:translateY(1px)}
.share-wrap{display:flex;gap:.5rem;flex-wrap:wrap;margin:.5rem 0}
.qr-box{display:flex;align-items:center;gap:.75rem;flex-wrap:wrap}
.badges{display:flex;gap:.5rem;flex-wrap:wrap;margin:.5rem 0}
.badge{padding:.25rem .6rem;border-radius:999px;background:rgba(255,255,255,.08);border:1px solid rgba(255,255,255,.12);font-size:.8rem}
.table-compact{width:100%;border-collapse:collapse;margin-top:.5rem}
.table-compact th,.table-compact td{border-bottom:1px solid rgba(255,255,255,.08);padding:.4rem .5rem;text-align:left;font-size:.9rem}
.table-compact th{opacity:.85}
.counter{font-weight:700}
@media(max-width:640px){ .qr-box{flex-direction:column;align-items:flex-start} }
#toast {visibility:hidden;min-width: 220px;margin-left:-110px;background:#111;color:#fff;text-align:center;border-radius:10px;padding:10px 12px;position:fixed;z-index:9999;left:50%;bottom:28px;font-size:14px;opacity:0;transition:opacity .35s,bottom .35s,visibility .35s}
#toast.show{visibility:visible;opacity:1;bottom:46px}
</style>

</head>
<body>

<header>
  <div class="container" style="display:flex;align-items:center;justify-content:space-between;padding:12px 0;">
    <div class="brand"><div class="brand-badge"></div> <div style="letter-spacing:.4px">TrustMe AI</div></div>
    <nav class="nav">
      <a href="index.html">Home</a>
      <a href="strategy.html">Strategy</a>
      <a href="assets.html">Assets</a>
      <a href="deposit.html">Deposit</a>
      <a href="withdraw.html">Withdraw</a>
    </nav>
    <div id="authArea"></div>
  </div>
</header>
<script src="auth-loader.js" defer>


function copyInviteLink(){
  var inp = document.getElementById('inviteLink');
  inp.select();
  inp.setSelectionRange(0, 99999);
  document.execCommand('copy');

  var t = document.getElementById("toast");
  t.className = "show";
  setTimeout(function(){ t.className = t.className.replace("show", ""); }, 2000);
}

</script>
<script src="auth-modals.js" defer>
<script src="tm-team-auto.js"></script>


function copyInviteLink(){
  var inp = document.getElementById('inviteLink');
  inp.select();
  inp.setSelectionRange(0, 99999);
  document.execCommand('copy');

  var t = document.getElementById("toast");
  t.className = "show";
  setTimeout(function(){ t.className = t.className.replace("show", ""); }, 2000);
}

</script>

<main class="container section team-wrap">
  <h1 style="font-family:Poppins,Inter,sans-serif;font-weight:700">My Team & Referrals</h1>

  <section class="card team-card">
    <div class="stripe"></div>
    <div class="invite-box">
      <div><strong>My Invite Code:</strong> <span id="inviteCode">â€”</span></div>
      <div style="margin-top:.5rem">
        <input id="inviteLink" class="input" style="width:100%" readonly>
      </div>
      <button class="copy-btn" id="copyInvite" style="margin-top:.5rem">Copy Invite Link</button>
    </div>

    <h2 class="pi-section-title">Referral Stats</h2>
    <div class="team-row"><div>Level 1 Referrals</div><div id="lvl1">0</div></div>
    <div class="team-row"><div>Level 2 Referrals</div><div id="lvl2">0</div></div>
    <div class="team-row"><div>Total Team Size</div><div id="totalTeam">0</div></div>
    <div class="team-row"><div>Total Commissions</div><div id="comm">0 USDT</div></div>
  </section>
</main>

<footer class="footer">
  <div class="container" style="text-align:center">
    <div class="brand" style="justify-content:center"><div class="brand-badge"></div> <div>TrustMe AI</div></div>
    <div class="nav" style="justify-content:center;margin-top:8px">
      <a href="index.html">Home</a>
      <a href="strategy.html">Strategy</a>
      <a href="assets.html">Assets</a>
      <a href="deposit.html">Deposit</a>
      <a href="withdraw.html">Withdraw</a>
    </div>
    <div class="small" style="margin-top:10px">
      Support: <a href="mailto:support@trustmeai.online">support@trustmeai.online</a>
      &nbsp;â€¢&nbsp;
      Telegram: <a href="#" target="_blank" rel="noopener">TrustMe AI Channel</a>
    </div>
    <div class="small" style="margin-top:10px">Â© TrustMe AI 2025</div>
  </div>
</footer>

<script>
  document.addEventListener("DOMContentLoaded", () => {
    const email = localStorage.getItem("tmUserEmail") || "";
    const invite = localStorage.getItem("tmInviteCode") || email.split("@")[0];
    document.getElementById("inviteCode").textContent = invite;
    document.getElementById("inviteLink").value = location.origin + "/?ref=" + encodeURIComponent(invite);

    document.getElementById("copyInvite")?.addEventListener("click", async () => {
      try {
        await navigator.clipboard.writeText(document.getElementById("inviteLink").value);
        alert("Invite link copied!");
      } catch {
        alert(document.getElementById("inviteLink").value);
      }
    });

    // Demo stats (can hook to backend later)
    var myCode = localStorage.getItem("tmInviteCode");
    var l1c = myCode ? (localStorage.getItem("countL1_"+myCode) || localStorage.getItem("tmRefL1") || "0") : (localStorage.getItem("tmRefL1") || "0");
    document.getElementById("lvl1").textContent = l1c;
    var myCode2 = localStorage.getItem("tmInviteCode");
    var l2c = myCode2 ? (localStorage.getItem("countL2_"+myCode2) || localStorage.getItem("tmRefL2") || "0") : (localStorage.getItem("tmRefL2") || "0");
    document.getElementById("lvl2").textContent = l2c;
    const total = (parseInt(document.getElementById("lvl1").textContent||"0",10) + parseInt(document.getElementById("lvl2").textContent||"0",10));
    document.getElementById("totalTeam").textContent = total;
    var myCode = localStorage.getItem('tmInviteCode');
    var earned = myCode ? parseFloat(localStorage.getItem('comm_'+myCode)||'0') : 0;
    document.getElementById('comm').textContent = earned.toFixed(2) + ' USDT';
  });



function copyInviteLink(){
  var inp = document.getElementById('inviteLink');
  inp.select();
  inp.setSelectionRange(0, 99999);
  document.execCommand('copy');

  var t = document.getElementById("toast");
  t.className = "show";
  setTimeout(function(){ t.className = t.className.replace("show", ""); }, 2000);
}

</script>
<div id="toast">Invite link copied!</div>
<script src="qrcode.min.js"></script>

<script>
function toast(msg){
  var t = document.getElementById("toast");
  t.textContent = msg || "Copied!";
  t.className = "show";
  setTimeout(function(){ t.className = t.className.replace("show",""); }, 1800);
}
function copyInviteLink(){
  var inp = document.getElementById('inviteLink');
  inp.select(); inp.setSelectionRange(0, 99999);
  document.execCommand('copy');
  toast('Invite link copied');
}
function copyInviteCode(){
  var inp = document.getElementById('inviteCode');
  inp.select(); inp.setSelectionRange(0, 99999);
  document.execCommand('copy');
  toast('Invite code copied');
}
function shareText(){
  var link = (document.getElementById('inviteLink').value||'').trim();
  return 'Join me on TrustMe AI ðŸš€ Earn profits with me ðŸ‘‰ ' + link;
}
function shareWhatsApp(){ window.open('https://wa.me/?text=' + encodeURIComponent(shareText()), '_blank'); }
function shareTelegram(){ window.open('https://t.me/share/url?url=' + encodeURIComponent(document.getElementById('inviteLink').value) + '&text=' + encodeURIComponent(shareText()), '_blank'); }
function shareTwitter(){ window.open('https://twitter.com/intent/tweet?text=' + encodeURIComponent(shareText()), '_blank'); }
function shareFacebook(){ window.open('https://www.facebook.com/sharer/sharer.php?u=' + encodeURIComponent(document.getElementById('inviteLink').value), '_blank'); }

function countUp(el, target, ms){
  var t0 = 0, steps = Math.max(20, Math.min(80, Math.floor(ms/20)));
  var step = target/steps;
  var i = 0;
  var timer = setInterval(function(){
    i++; t0 += step;
    if(i>=steps){ t0 = target; clearInterval(timer); }
    el.textContent = String(Math.floor(t0));
  }, 20);
}

function badgeFor(l1, l2, comm){
  var total = l1 + l2;
  if (comm >= 1000 || total >= 200) return ['Master', 'ðŸ”¥'];
  if (comm >= 200  || total >= 50)  return ['Pro', 'ðŸš€'];
  if (comm >= 50   || total >= 10)  return ['Rookie', 'ðŸŽ¯'];
  return ['New', 'âœ¨'];
}

function ensureInviteData(){
  var me = localStorage.getItem('tmInviteCode');
  if(!me){
    me = "TM" + Math.random().toString(36).slice(2,8).toUpperCase();
    localStorage.setItem('tmInviteCode', me);
  }
  var link = location.origin + location.pathname.replace(/\/[^\/]*$/, "/index.html") + "?ref=" + encodeURIComponent(me);
  if (localStorage.getItem("tmRefBy")) link += "&u2=" + encodeURIComponent(localStorage.getItem("tmRefBy"));
  var codeEl = document.getElementById("inviteCode");
  var linkEl = document.getElementById("inviteLink");
  if (codeEl) codeEl.value = me;
  if (linkEl) linkEl.value = link;
  return {me, link};
}

function renderQR(text){
  try{
    var el = document.getElementById("inviteQr");
    if (!el) return;
    el.innerHTML = "";
    new QRCode(el, {text: text, width: 120, height: 120, correctLevel: QRCode.CorrectLevel.H});
  }catch(e){}
}

// Earnings table: read from localStorage ref logs OR infer minimal demo from counters
function loadEarnings(myCode){
  var key = 'refLogs_' + myCode;
  var rows = [];
  try { rows = JSON.parse(localStorage.getItem(key)||'[]') } catch(e){ rows = [] }
  var tbody = document.querySelector('#earnTbl tbody');
  if (!tbody) return;
  tbody.innerHTML = '';
  rows.slice(-10).reverse().forEach(function(r){
    var tr = document.createElement('tr');
    tr.innerHTML = '<td>'+ (r.time||'') +'</td><td>'+ (r.level||'') +'</td><td>'+ Number(r.amount||0).toFixed(2) +'</td><td>'+ Number(r.commission||0).toFixed(2) +'</td>';
    tbody.appendChild(tr);
  });
}

function exportTeamCSV(){
  try {
    var me = localStorage.getItem('tmInviteCode')||'ME';
    var key = 'refLogs_' + me;
    var rows = [];
    try { rows = JSON.parse(localStorage.getItem(key)||'[]') } catch(e){ rows = [] }
    var csv = 'Time,Level,Deposit,Commission\n';
    rows.forEach(function(r){
      csv += [r.time, r.level, r.amount, r.commission].join(',') + '\n';
    });
    var blob = new Blob([csv], {type:'text/csv'});
    var a = document.createElement('a');
    a.href = URL.createObjectURL(blob);
    a.download = 'team_earnings.csv';
    a.click();
  } catch(e){ console.error(e); }
}

document.addEventListener('DOMContentLoaded', function(){
  var data = ensureInviteData();
  renderQR(data.link);

  // Counters + badge
  var l1 = parseInt(localStorage.getItem('countL1_'+data.me) || localStorage.getItem('tmRefL1') || '0', 10);
  var l2 = parseInt(localStorage.getItem('countL2_'+data.me) || localStorage.getItem('tmRefL2') || '0', 10);
  var comm = parseFloat(localStorage.getItem('comm_'+data.me) || '0');
  var lvl1El = document.getElementById('lvl1'), lvl2El = document.getElementById('lvl2'), totalEl = document.getElementById('totalTeam'), commEl = document.getElementById('comm');
  if (lvl1El) countUp(lvl1El, l1, 600);
  if (lvl2El) countUp(lvl2El, l2, 600);
  if (totalEl) countUp(totalEl, l1+l2, 700);
  if (commEl) commEl.textContent = comm.toFixed(2) + ' USDT';

  var bd = badgeFor(l1,l2,comm);
  var bWrap = document.getElementById('badgeWrap');
  if (bWrap) {
    bWrap.innerHTML = '<span class="badge">'+bd[1]+' '+bd[0]+'</span>';
  }

  // Load earnings table
  loadEarnings(data.me);
});
</script>

</body>
</html>
